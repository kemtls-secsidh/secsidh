#include "fp-gmp.h"
#include "../fp-counters.h"
// #include "framework.h"
#include "../../primes.h"

#include <gmp.h>

//#define USE_GMP_SEC_FUNCTIONS
//#define MONTGOMERY

#if defined P2047m1l226
const fp p = {
0xFFFFFFFFFFFFFFFF,0xCB336E65DD9AB972,0x31DA9904076E6A70,0x9F825D7BEA428F54, 
0x80B1D7895DEABE60,0xD3B3CDE44A99EBD8,0x2C433638FE69F531,0x46C02600030671E2,
0x3EB36EBF24EB264F,0x5872FD3292CF3725,0x25261B882C99A891,0x5AA0C7A8E51C618F, 
0xDFE30228DC090A5E,0x1235FFF9C3496720,0x556D82DFB25A19E0,0xAF0D91A49AD1FCF6, 
0x5CFE8BDDCAAF7214,0x67D90F84820F3740,0x85DD61C29F9EA3FA,0x1B493E97510173BA, 
0x57963F8A2EF281C0,0x215B3CA607652A95,0xBE13D52039838268,0xC1B8B0AC479FC5EB, 
0xAACDDF254A1CEFF1,0x5D89B511362EE752,0x5C935F8B2C251C39,0x3336CCFC4DD81041, 
0xFE4AEA834B8F332,0x8AA77CDCE5CCA52,0x2DD1AFC034E7A378,0x4B5882EA64EA57E7 };

const fp r_squared_mod_p = {
0x7F4DD8E5DF23BB8,0x5C776D52280157ED,0x649F1DDABA652A4C,0x5F82754E976E1C51,
0x216A66554955B423,0x837F16EBDA6112EC,0x449BE2BE3F1308CA,0xD417CF96FBD398E, 
0xF40CA379B3CFDD87,0xE572142C0A18BEF2,0x174A98FEF7CBBD6D,0x92147FED3A21520A, 
0xC2FEF4524FB5A582,0x7EA04A000CF05B29,0xEE7604D0586AEE7,0x360C6B9E4402ACBE, 
0x2412C3AB8629CC28,0x11843E0F489CD4DA,0x965E567F2D69ADA1,0xC35FDB6E0A1CE3AC, 
0xDFCE999B5BE1D15D,0xADFC765457B8334C,0x178A9115F96B28ED,0x7C25482F10317EEF, 
0x87B1090C7F92BA82,0xF6E929FCF67F4BB3,0xDAB73BE93D26BAA6,0xA520E31962981EFB, 
0xD1EBB498F914FB73,0x71AAAC9068F25B31,0x18F8EE6ACA512273,0x2EA634B399D69CF7 };
const fp p_minus_2 = {
0xFFFFFFFFFFFFFFFD,0xCB336E65DD9AB972,0x31DA9904076E6A70,0x9F825D7BEA428F54, 
0x80B1D7895DEABE60,0xD3B3CDE44A99EBD8,0x2C433638FE69F531,0x46C02600030671E2, 
0x3EB36EBF24EB264F,0x5872FD3292CF3725,0x25261B882C99A891,0x5AA0C7A8E51C618F, 
0xDFE30228DC090A5E,0x1235FFF9C3496720,0x556D82DFB25A19E0,0xAF0D91A49AD1FCF6, 
0x5CFE8BDDCAAF7214,0x67D90F84820F3740,0x85DD61C29F9EA3FA,0x1B493E97510173BA, 
0x57963F8A2EF281C0,0x215B3CA607652A95,0xBE13D52039838268,0xC1B8B0AC479FC5EB, 
0xAACDDF254A1CEFF1,0x5D89B511362EE752,0x5C935F8B2C251C39,0x3336CCFC4DD81041, 
0xFE4AEA834B8F332,0x8AA77CDCE5CCA52,0x2DD1AFC034E7A378,0x4B5882EA64EA57E7 };
const fp inv_min_p_mod_r = {
0x1,0xCB336E65DD9AB973,0xAF643763A21D419,0x9F2BDE02384F089B,
0xEEEE4E67E761E071,0xE14F6E448846FC16,0x7C33F1CB8995D537,0x9C5E5A0E41FBBB2B,
0x4018415AA62AB0F7,0x570A5C7C482D3FA4,0x290CBC45D2ED6704,0x6935DDB9DA0BF373, 
0xA9C3A7DCE054C2E7,0x1A92280608691985,0x786A946F6A893A4E,0x817444232C2B50DA, 
0x51BC998B9190158,0xED0A80A509441339,0x70CCCC137B5E8F1D,0x425869F7AD1DEB2C, 
0xE27606BD4F848CE,0xF78A71E7CFC37870,0x347E7689108AA61E,0xD89DFF0D518DFEFF, 
0x7223F57C599BD0D8,0xA84199D7B55177A2,0xBADC4BDDEB193D87,0x3C4583C1A5C1CD7, 
0x8ACB116EB508F9DF,0x23F88493636893F,0x47A93C3A24EFEA29,0x5420403EEAB4C43E };

#ifdef MONTGOMERY
const fp fp_1 = {
0x3,0x9E65B4CE672FD3A7,0x6A7034F3E9B4C0AD,0x2178E78C41385203,
0x7DEA7963E63FC4DE,0x84E4965320323C76,0x7B365D5504C2206A,0x2BBF8DFFF6ECAA59,
0x43E5B3C2913E8D12,0xF6A7086847925A90,0x908DAD677A33064B,0xF01DA90550AADB52, 
0x6056F9856BE4E0E4,0xC95E0012B623CA9D,0xFFB77760E8F1B25F,0xF2D74B122F8A091C, 
0xE9045C669FF1A9C1,0xC874D17279D25A3E,0x6E67DAB821241410,0xAE24443A0CFBA4D0, 
0xF93D416173287ABF,0x9BEE4A0DE9D0803F,0xC5C4809F537578C7,0xBAD5EDFB2920AE3C, 
0xFF96629021A9302A,0xE762E0CC5D734A07,0xEA45E15E7B90AB53,0x665B990B1677CF3B, 
0xD051F40761D52669,0xE600989694E9A109,0x768AF0BF61491597,0x1DF67740D140F84A };

#else
const fp fp_1 = {0x1};
#endif

#define pbits 2047
#define itch_size 128

#elif defined P4095m27l262
const fp p = {
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xBABB857F53B45F38, 
0xA0FA17C9F017AAA4,0xCA367EE9DCA136B3,0x9825FE450B3306F0,0x7598BC71B003BE60, 
0x75D9C93D2F88118F,0x25FAB108318489EF,0xB853C0B81A59A320,0xA68AC2FAA6576BD0, 
0x6FE6DE6B60B8DD73,0xBE1BA97A296DF474,0x90F3D594E0BB1B1A,0x50845534C663819,
0x5DA43F39BA465F9D,0x67A79C055011CD6C,0x10AABAC0E83F00E0,0x55B21EF174813BB, 
0xB32A5B550F65F8E8,0x6C8A637162557E06,0x184398D9CE7B8ED0,0xF6389D60A659DBF9, 
0x4898DDCC4C6451B1,0xD34D57E179DBAA87,0xB300098DDDD2A53D,0x4D83B4D248CD8DC8, 
0xA999042BBABBA293,0x8E37AAC3FD7145B5,0x896199C58C6CDEE2,0x5D499CA3173C69A1, 
0x324B4917CB3C3BFA,0xF83956A2F7A46669,0xE0CA5CB997EAFB95,0x16C0EB2AAF99D121, 
0xAF95A6D3DA6A40FF,0x8EDE5A2EF574F91F,0xF17F15465794272,0x411889A889DBBAF2};
const fp r_squared_mod_p = {
0xCA9664131ABC0203,0xBBACA9841048F533,0x8EABAAFDB1A5302C,0x8717BB74DAE9C8CC,
0xDB09FDAD266C9FE3,0x87FE292E7623BBAC,0xC4608F8CDD193747,0x29756590B837429E, 
0x25E069B05DF9158B,0x81B88A6E00EB97D7,0xFEB41576DF0529FE,0x75DCB5D79F31D7BD, 
0x4ECF835F54A00B39,0x12BDF9E28ADE3FA0,0xBE1FC6DF5625BA99,0x387429A496E48929, 
0x26C1594875AAEC54,0xF55991263DCDBF72,0x824598E7E40BF31C,0xCF0D0408B41080C8, 
0x6E8ED3548F1C53E3,0xE89C93835E6CB9A7,0xB8F73FC08D85EEAA,0x16813517F4D53663, 
0xBDABAD4E8AD094D7,0xC8F4E4BC812987AB,0xF2B12B6984FB1324,0xDCF1220EFBBDF5BF, 
0xD4ADE1120C73CECE,0xFF966A2C8A47A0CC,0x90B723888F342AB4,0xBBFFE44E9B103534, 
0x7A6882E784FAFFFD,0x2032BA8B44CD3D68,0xE59012732A0507CE,0x41030A597B14046D, 
0x70338B98F4FD3DF5,0xF9DBB4D3531E71A0,0xE09D4FD229D810B6,0x1F73C8F1FBBCF3F4, 
0xBDA5F434EDB6FD3B,0x138E4F816D09F0BE,0x4D29DC6B345CC58F,0x48365C1D1C10AD63, 
0x8799389318D2A8C2,0xDC983E5063104657,0x1BCDA74009C0B95A,0x46AC0180E7080A18, 
0x1ECE665A556B2D85,0xBE187F58C05BF423,0x137C3D745FCF8564,0xE94225E253BCC1FF, 
0xE18A90228B1C625E,0xED4C0E96616F842B,0x79EFB7D08707F5AF,0xB0FC6FF8828CCFD0, 
0x5459C35AFF8A0F53,0x55F5A04678F556B0,0xD8CBCC2A34884A9C,0xB64BC960DEA1137F, 
0x276AA6537115111B,0xE8F7B5C15A55D484,0x8CB566E62B90747C,0x2B202E35F35F4C36};
const fp p_minus_2 = {
0xFFFFFFFFFFFFFFFD,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xBABB857F53B45F38, 
0xA0FA17C9F017AAA4,0xCA367EE9DCA136B3,0x9825FE450B3306F0,0x7598BC71B003BE60, 
0x75D9C93D2F88118F,0x25FAB108318489EF,0xB853C0B81A59A320,0xA68AC2FAA6576BD0, 
0x6FE6DE6B60B8DD73,0xBE1BA97A296DF474,0x90F3D594E0BB1B1A,0x50845534C663819, 
0x5DA43F39BA465F9D,0x67A79C055011CD6C,0x10AABAC0E83F00E0,0x55B21EF174813BB, 
0xB32A5B550F65F8E8,0x6C8A637162557E06,0x184398D9CE7B8ED0,0xF6389D60A659DBF9, 
0x4898DDCC4C6451B1,0xD34D57E179DBAA87,0xB300098DDDD2A53D,0x4D83B4D248CD8DC8, 
0xA999042BBABBA293,0x8E37AAC3FD7145B5,0x896199C58C6CDEE2,0x5D499CA3173C69A1, 
0x324B4917CB3C3BFA,0xF83956A2F7A46669,0xE0CA5CB997EAFB95,0x16C0EB2AAF99D121, 
0xAF95A6D3DA6A40FF,0x8EDE5A2EF574F91F,0xF17F15465794272,0x411889A889DBBAF2};
const fp inv_min_p_mod_r = {
0x1,0x0,0x0,0x0,
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0xBABB857F53B45F39,
0xA0FA17C9F017AAA4,0xCA367EE9DCA136B3,0x9825FE450B3306F0,0x7598BC71B003BE60,
0x75D9C93D2F88118F,0x25FAB108318489EF,0xB853C0B81A59A320,0xA68AC2FAA6576BD0,
0x6FE6DE6B60B8DD73,0xBE1BA97A296DF474,0x90F3D594E0BB1B1A,0x50845534C663819, 
0x5DA43F39BA465F9D,0x67A79C055011CD6C,0x10AABAC0E83F00E0,0x55B21EF174813BB, 
0xB32A5B550F65F8E8,0x6C8A637162557E06,0x184398D9CE7B8ED0,0xF6389D60A659DBF9, 
0x4898DDCC4C6451B1,0xD34D57E179DBAA87,0xB300098DDDD2A53D,0x4D83B4D248CD8DC8,
0xA999042BBABBA293,0x8E37AAC3FD7145B5,0xDEDC3288E003993,0x28FCCC134500ED9, 
0x99237E427A9541FF,0x979318575D8DA63E,0xCD99020B3B318AB8,0xF038B83232D3D40A, 
0x8B6DB111DCEFF4B8,0x9204380C67BBB04,0x4DC7D4B3C7C3F798,0x76E2C34D5BDB8598};

#ifdef MONTGOMERY
const fp fp_1 = {
0x3,0x0,0x0,0x0,
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0xCFCD6F8204E2E255,
0x1D11B8A22FB90011,0xA15C83426A1C5BE5,0x378E0530DE66EB2D,0x9F35CAAAEFF4C4DE,
0x9E72A4487167CB51,0x8E0FECE76B726231,0xD704BDD7B0F3169F,0xC5FB7100CF9BC8D, 
0xB04B64BDDDD567A5,0xC5AD039183B622A2,0x4D247F415DCEAEAF,0xF0E730061ACD57B3, 
0xE7134252D12CE128,0xC9092BF00FCA97BA,0xCDFFCFBD4742FD5E,0xEFEE9A32BA27C4CE, 
0xE680EE00D1CE1547,0xBA60D5ABD8FF85EB,0xB7353572948D538E,0x1D5627DE0CF26C14, 
0x2635669B1AD30AEA,0x8617F85B926D006A,0xE6FFE35666881046,0x1774E189259756A5, 
0x334F37CCFCD1846,0x5558FFB407AC2EDF,0x63DB32AF5AB96358,0xE8232A16BA4AC31B, 
0x691E24B89E4B4C10,0x1753FC171912CCC4,0x5DA0E9D3383F0D3E,0xBBBD3E7FF1328C9A, 
0xF13F0B8470C13D02,0x5364F1731FA114A0,0xD2B82C02CF9438A8,0x3CB66306626CCF29};
#else
const fp fp_1 = {0x1};
#endif

#define pbits 4095
#define itch_size 256

#elif defined P5119m46l244
const fp p = {
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xB5309D1E99A64A6A,0xD4F20F3D310BE993, 
0xD92726C717015CFD,0xF06D7BAB9FBC61BA,0xC2EE5257F3F53C0A,0x3AF92D2E448901D2, 
0x3A0C8A8186EE6D0D,0x53C4B1599AEEC0E1,0xE4EACE2722BC33D6,0x238DC49B3B1C9CC, 
0xB8D14D0F82E0AFB5,0x3B1B2AB37CD1DF46,0x7B9D7D5D4927ED03,0xADC309FAFEB712E0, 
0x1E9A86229953557A,0x1F15A379F4EF9329,0xA65C5A1161E1D325,0xB8711C1B97A356D8, 
0x6AD52806F4121BE7,0x951B321B6C3C584C,0xD4EDED55AFC190E5,0x56CF35332848D386, 
0xF6322D985F4F8905,0x37E31D4DDBC39AD6,0xBCFFB1DE739D78F0,0xBFBF3DA580661DCC, 
0x5CFB6A9766C03723,0x1BAA906DE71522B6,0xD76E42C1E401FF20,0xA69EFCEFEF88BD2E, 
0xA0A2737A7E193839,0x68C24DC989220343,0x524C926C9F96C9CF,0x6B5ECF5EB8DE6C90};
const fp r_squared_mod_p = {
0x3B6858C6EA09FF39,0xC0C1A01FC66553BF,0xBF1C26B03D13448D,0xCEE65529DB4276C6, 
0x263216DC529FA0E,0x1064C4347BDEEE65,0xE0A9109823C9039A,0xADA812BBB0D2D2CE, 
0x58633B8D4B5C35BA,0xDA399891C3CA96B0,0xCB943DC5AD81966C,0xE157868A016EAF8F, 
0x6993ABD64C6304CF,0xE01D2BB15467A629,0xFF811CCFF0BC9F26,0x9EDC510CD20C3FEA, 
0xCF05F2DD5DF5214F,0x7105AFC7967757B,0x1E9AA04F82608BE6,0x8CC448337DD40BB3, 
0x1E91E2EE0BA2628A,0xE944B17DAA7E75A3,0xD16BA714A0148CB1,0x80B88C8429F6700E, 
0x83A8759BF83CF558,0x7AFCC7F87611BDB8,0x7254245CB9DD9DE7,0xF1288B81E6B10E99, 
0xD18C267CEBA3F6D4,0xF8D367B197112BF,0xE7EEC1B008858F7D,0x59BAB08FF24DFCE2, 
0xCB7750FAB0A9DBAC,0x4C38E3A5BB5D6793,0xCA09905B939E13A,0x79099E2C2B7B8D5E, 
0x8D917855EF331AE4,0xFBEE792CF496564D,0x63B46BB42339F99E,0x164D487ABD553DA9, 
0x1FE539A1C0233F64,0xD54A9A356B55B86E,0x461FAABE484D85BF,0x5BC0E4B7B2996C6D, 
0x16B704B7EE90E039,0x90C046EAF2EE369B,0x5A3F5E29E205FB7B,0x941D41A97F9A2E31, 
0xB30C70F20F70CB36,0xA766CBA7A81DA5ED,0xC6CBFA0579541D21,0x8158A5A6310D5592, 
0x5D331ACA8A018A36,0xC58988AEA16BA091,0xC1B95F08B0A1CD3E,0x1FEE3B3C136B3C25, 
0xF604C3F7DCFB1769,0x8F0981ABF7CCEC30,0xADC387AF7A71D8F2,0xBA0397BD54E38EBD,
0x12706EDAB696BE65,0x6E272E35D79CE370,0xEFDCE9C846E22985,0x271B00F78817CDF7, 
0x62A7CD3B88536B4A,0xEBF82C1F791DB225,0x701BF73194E21823,0x9A7D7C09E114C256, 
0xF791706806F0F525,0x8EF51F6403121129,0x48BA0645DF412D6B,0xCF3A4C68615D4A05, 
0x59D9DC740C1D2A03,0xE7DA10BCF7AA2,0xBA8B94C9E733AAB2,0xAFB849D79563DFE9, 
0x8482B243768BD44F,0x9A7716C39F4ADA39,0x38E0B51760EEBE36,0x2F644368EA43512};
const fp p_minus_2 = {
0xFFFFFFFFFFFFFFFD,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xB5309D1E99A64A6A,0xD4F20F3D310BE993, 
0xD92726C717015CFD,0xF06D7BAB9FBC61BA,0xC2EE5257F3F53C0A,0x3AF92D2E448901D2,
0x3A0C8A8186EE6D0D,0x53C4B1599AEEC0E1,0xE4EACE2722BC33D6,0x238DC49B3B1C9CC, 
0xB8D14D0F82E0AFB5,0x3B1B2AB37CD1DF46,0x7B9D7D5D4927ED03,0xADC309FAFEB712E0, 
0x1E9A86229953557A,0x1F15A379F4EF9329,0xA65C5A1161E1D325,0xB8711C1B97A356D8,
0x6AD52806F4121BE7,0x951B321B6C3C584C,0xD4EDED55AFC190E5,0x56CF35332848D386, 
0xF6322D985F4F8905,0x37E31D4DDBC39AD6,0xBCFFB1DE739D78F0,0xBFBF3DA580661DCC, 
0x5CFB6A9766C03723,0x1BAA906DE71522B6,0xD76E42C1E401FF20,0xA69EFCEFEF88BD2E, 
0xA0A2737A7E193839,0x68C24DC989220343,0x524C926C9F96C9CF,0x6B5ECF5EB8DE6C90};
const fp inv_min_p_mod_r = {
0x1,0x0,0x0,0x0,
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0xB5309D1E99A64A6B,0xD4F20F3D310BE993,
0xD92726C717015CFD,0xF06D7BAB9FBC61BA,0xC2EE5257F3F53C0A,0x3AF92D2E448901D2,
0x3A0C8A8186EE6D0D,0x53C4B1599AEEC0E1,0xE4EACE2722BC33D6,0x238DC49B3B1C9CC, 
0xB8D14D0F82E0AFB5,0x3B1B2AB37CD1DF46,0x7B9D7D5D4927ED03,0xADC309FAFEB712E0, 
0x1E9A86229953557A,0x1F15A379F4EF9329,0xA65C5A1161E1D325,0xB8711C1B97A356D8, 
0x6AD52806F4121BE7,0x951B321B6C3C584C,0xD4EDED55AFC190E5,0x56CF35332848D386, 
0xF6322D985F4F8905,0x37E31D4DDBC39AD6,0xBCFFB1DE739D78F0,0xBFBF3DA580661DCC, 
0x5CFB6A9766C03723,0x1BAA906DE71522B6,0xD76E42C1E401FF20,0xA69EFCEFEF88BD2E, 
0xA0A2737A7E193839,0x68C24DC989220343,0x524C926C9F96C9CF,0x6B5ECF5EB8DE6C90};

#ifdef MONTGOMERY
const fp fp_1 = {
0x2,0x0,0x0,0x0,
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x959EC5C2CCB36B2A,0x561BE1859DE82CD8,
0x4DB1B271D1FD4604,0x1F2508A8C0873C8A,0x7A235B50181587EA,0x8A0DA5A376EDFC5A,
0x8BE6EAFCF22325E5,0x58769D4CCA227E3D,0x362A63B1BA879853,0xFB8E476C989C6C66, 
0x8E5D65E0FA3EA095,0x89C9AA99065C4172,0x8C505456DB025F9,0xA479EC0A0291DA3F, 
0xC2CAF3BACD59550A,0xC1D4B90C1620D9AD,0xB3474BDD3C3C59B5,0x8F1DC7C8D0B9524E, 
0x2A55AFF217DBC830,0xD5C99BC927874F67,0x56242554A07CDE34,0x52619599AF6E58F2, 
0x139BA4CF4160EDF5,0x9039C5644878CA52,0x86009C4318C50E1F,0x808184B4FF33C466, 
0x46092AD1327F91B8,0xC8AADF2431D5BA93,0x51237A7C37FC01BF,0xB2C2062020EE85A2, 
0xBEBB190B03CD8F8C,0x2E7B646CEDBBF978,0x5B66DB26C0D26C61,0x294261428E4326DF};
#else
const fp fp_1 = {0x1};
#endif

#define pbits 5119
#define itch_size 322

#elif defined P6143m59l262
const fp p = {
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0x35985E4C03BD1014, 
0x74C88B0E3733AB9E,0xCC5EBC3CA4FAA947,0x821D23FC31769999,0x7DD81C7ECF287336, 
0x397B3BC1E4878A95,0x4668669E24F5CD05,0x45C68D7E8D5BA6E8,0x63DAA86AB6F4AA9E, 
0x4FEADF6BA95A3814,0xC14DC5EE6A02B1CD,0xCCAAB92DABD0F3E2,0x5C5DE133E486EA2A, 
0x149B3990755103CF,0x7E37E927A1F549AC,0xB41FA73F044C2191,0x1558E943308D9356, 
0xCC51A5F650F1DDE6,0x9CB2FD4B418C0807,0xFDAC42332803B31B,0x3FE7C77E1BD479FC, 
0x77B20071167346DE,0x63DA3A20500E6BE1,0xEBBB7C777054734A,0xA71872C190AEABFF, 
0xA13B14217BC25602,0x3BF5A900D843EEF1,0x2D83E22FC80D9EC1,0x3FAC5F1728799D3D, 
0x289BCF6DC62ADBCE,0x65606A37CBFD6BBA,0x4025C0EB0BD9BC24,0x316E981BB3081481, 
0xFFAE9D83F13FD711,0x3A4C4B7B7647853E,0x1D234B4CEA41F44B,0x5475A30084FF51D6};
const fp r_squared_mod_p = {
0xEA1076E527DE13D2,0xC52E0483E2754A2E,0x5436E0A0C9B4B9B0,0x36B05C5BE329B851, 
0x841BEB22660A7F99,0xA41D5874CB9BB130,0x14F7C9564D190F6D,0x3D016994D56DC0D5, 
0x6FBC560206DCFC,0x287A31B541B41B73,0xD475ED64F68C23EF,0x3AF40FB5B2217366, 
0x61B2DB68718CA1D8,0xDE27B57ACF3EA0E9,0x19539863C951FC69,0x29B914EF38EFECB6, 
0xBF824A1A7F094517,0x9A227DA653BE3451,0x2BE700C9E0A5CF88,0x714DCADC04986290, 
0x8D1B250772E3FC6F,0x6E1979C64A6950FC,0x3DE9DB2EC7CFE4D7,0x41DFB16712835AD3, 
0xC8A4DA1ADCE1EA57,0xE79127BAFF6E4CE4,0x58DBB651E1FD5E83,0x1233EC7FC7A76EAD, 
0x10BEE487E2D20C5D,0xFC3D4345B89B0D88,0x4BFCA0D6C91C2E89,0x852F09D77DFE7B8D, 
0xC6F6FCDE180A8C7B,0x679EA8E6F3C66D2F,0xC3686AD1DFD71DA2,0x6F974B5AC8499469, 
0x6CE93E51EFDA6C77,0xAABDE4102AEAB7CB,0xE07ABF93F88447E,0x6FD8F23A45AB18F7, 
0x82BA3DE4FC056F7E,0x6B9CED500E61076E,0xC76158874C44F077,0x8019FB6AD3CEECAA, 
0x124EECB38098B680,0x2831C66750810633,0x1CFCD7437BD43E43,0x79F3B8EBDBFA28B5, 
0x18CDBBCD1671D212,0xD8FBBD1C9DB803F5,0x544FDB9742C04755,0x3C10AD2C03ED7F66, 
0xE26C19B6728EF975,0xB2DE0DCBFE031E63,0xF3FC921114247ECC,0x5441123FA874BA68, 
0xE3E034B43BF6EAE1,0xF5B4D8750F96C276,0x43741756C7A8EB9F,0x3BE507C2CDD316D2, 
0xF222366AAC72246E,0xDAFD3EEAB249E29D,0xAF3F026F58864E82,0x3CB6D1762D698008, 
0x334F8CFDE69BC30D,0x68CA56C4D05338E3,0xAE6F07AE1529BFCF,0xBDC400071E5A9DE7, 
0xFF7F6A1C8FE9750F,0x304E721C9FCC7884,0x796662377CE1F0AB,0x814B06A81F56D886, 
0x860CA75B9B6174F0,0x22A7776F8EC1B8CD,0x9B4BA313C44FE88D,0x4E3B5B720B6B0A1E, 
0x86C141F3C572195C,0x54C050368D8A3E02,0xCCE3FF5FDFE6A3AC,0xCDE2F0AE3E357604, 
0x6E2C8832740443,0xE61AECA7076C0558,0xC230DB509FB70D94,0x40C2E5EB595779AE, 
0x5B42311CD71CD2DC,0x1D33D362D2D3F25C,0x31C87F44C917374B,0x158AC965518F7419, 
0x7909DAA97DBCA21E,0x1AABE4853A468E60,0xF67CDEECBC59C895,0x1B1C1C8377584087, 
0x248E6A6B6C149308,0x5BD0155136187521,0x69B1017EADBBA771,0x3EA89DA336AAFB31};
const fp p_minus_2 = {
0xFFFFFFFFFFFFFFFD,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0x35985E4C03BD1014, 
0x74C88B0E3733AB9E,0xCC5EBC3CA4FAA947,0x821D23FC31769999,0x7DD81C7ECF287336, 
0x397B3BC1E4878A95,0x4668669E24F5CD05,0x45C68D7E8D5BA6E8,0x63DAA86AB6F4AA9E, 
0x4FEADF6BA95A3814,0xC14DC5EE6A02B1CD,0xCCAAB92DABD0F3E2,0x5C5DE133E486EA2A, 
0x149B3990755103CF,0x7E37E927A1F549AC,0xB41FA73F044C2191,0x1558E943308D9356, 
0xCC51A5F650F1DDE6,0x9CB2FD4B418C0807,0xFDAC42332803B31B,0x3FE7C77E1BD479FC, 
0x77B20071167346DE,0x63DA3A20500E6BE1,0xEBBB7C777054734A,0xA71872C190AEABFF, 
0xA13B14217BC25602,0x3BF5A900D843EEF1,0x2D83E22FC80D9EC1,0x3FAC5F1728799D3D, 
0x289BCF6DC62ADBCE,0x65606A37CBFD6BBA,0x4025C0EB0BD9BC24,0x316E981BB3081481, 
0xFFAE9D83F13FD711,0x3A4C4B7B7647853E,0x1D234B4CEA41F44B,0x5475A30084FF51D6};
const fp inv_min_p_mod_r = {
0x1,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x35985E4C03BD1015,
0x74C88B0E3733AB9E,0xCC5EBC3CA4FAA947,0x821D23FC31769999,0x7DD81C7ECF287336, 
0x397B3BC1E4878A95,0x4668669E24F5CD05,0x45C68D7E8D5BA6E8,0x63DAA86AB6F4AA9E, 
0x4FEADF6BA95A3814,0xC14DC5EE6A02B1CD,0xCCAAB92DABD0F3E2,0x5C5DE133E486EA2A, 
0x149B3990755103CF,0x7E37E927A1F549AC,0xB41FA73F044C2191,0x1558E943308D9356, 
0xCC51A5F650F1DDE6,0x9CB2FD4B418C0807,0xFDAC42332803B31B,0x3FE7C77E1BD479FC, 
0x77B20071167346DE,0x63DA3A20500E6BE1,0xEBBB7C777054734A,0xA71872C190AEABFF, 
0xA13B14217BC25602,0x3BF5A900D843EEF1,0x2D83E22FC80D9EC1,0x3FAC5F1728799D3D, 
0x289BCF6DC62ADBCE,0x65606A37CBFD6BBA,0x4025C0EB0BD9BC24,0x316E981BB3081481, 
0xFFAE9D83F13FD711,0x3A4C4B7B7647853E,0x1D234B4CEA41F44B,0x5475A30084FF51D6};

#ifdef MONTGOMERY
const fp fp_1 = {
0x3,0x0,0x0,0x0,
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x5F36E51BF4C8CFC1,
0xA1A65ED55A64FD25,0x9AE3CB4A11100429,0x79A8940B6B9C3332,0x8677AA839286A65C,
0x538E4CBA5269603F,0x2CC6CC25911E98F0,0x2EAC578457ED0B47,0xD47006BFDB220025, 
0x103F61BD03F157C2,0xBC16AE34C1F7EA98,0x99FFD476FC8D2457,0xEAE65C64526B417F, 
0xC22E534EA00CF491,0x855844891A2022FB,0xE3A10A42F31B9B4B,0xBFF544366E5745FB, 
0x9B0B0E1D0D2A664D,0x29E7081E3B5BE7E8,0x6FB396687F4E6AD,0x4048A985AC829209, 
0x98E9FEACBCA62B65,0xD471519F0FD4BC5B,0x3CCD8A99AF02A620,0xAB6A7BB4DF3FC00, 
0x1C4EC39B8CB8FDF8,0x4C1F04FD7734332B,0x77745970A7D723BC,0x40FAE2BA86932848, 
0x862C91B6AD7F6C95,0xCFDEC1589C07BCD1,0x3F8EBD3EDC72CB92,0x6BB437ACE6E7C27C, 
0xF427742C407ACC,0x511B1D8D9D297043,0xA8961E19413A231E,0x29F16FE71020A7D};
#else
const fp fp_1 = {0x1};
#endif

#define pbits 6143
#define itch_size 386

#elif defined P8191m78l338
const fp p = {
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0x3EAF65A95F0041EC,0x372B7D9154133882, 
0x5A58A580E1CA9829,0x8FC4156DDCAD437,0x4CE6AE3C63765131,0x4F3865F90F46D0D3, 
0xB6AA2C454C34E51B,0xD434D3F80A147B77,0x6B926F74A2AA5C76,0x43BCB530BDFEAFF9, 
0x671D6CE9572B43C1,0xD5B30D80ECB73020,0xF823265621739F49,0xC1754744306061CA, 
0x6171E42D89E177BB,0x8994F48EF23A7F2A,0xA2057C82B399C3AF,0xC60CD8BEC9D528B1, 
0xB9B5FAB739469676,0x601A2E4779AEC853,0xE00D857E16B58377,0xE65DEF66D0C08A1D, 
0x26692BC11E11E82B,0x3A2B8F6CD365560D,0x39E653855729C7FB,0xC10B3B5E0D9DE1C4, 
0x7D13530314EEC59E,0xD0A1B556BFEAF779,0xE63C16F48D4938B9,0x3839DF74876C52B0, 
0x5AD0EACB1BD7283,0xC1709D8F85717F0F,0x185BC2F57DE71EB1,0x2F9EC8170F78D4E0, 
0xF519D562D85DB142,0x9CCB77F2238053C5,0x6BB5CF773506E8B0,0x2770E39BEED00FEB, 
0x3A51E0099D663BC,0x5E93F3908FA8986E,0x4AE63438608085B,0x5290F3FDF0F9F666, 
0xA5E5B7F7D86B7F44,0xAB4BD70919AC3458,0x60473AD832847641,0xC35589BD7E5B6D68, 
0x60340C810D6E6475,0xDA4E9331BBBE84E,0x8726969D65FA39A0,0x558064826AE53F6C};
const fp r_squared_mod_p = {
0x48FF50537902DF76,0xC2BEB8EDB7A746B,0xB191B393624EDDC9,0x5FDA25C18B693E94, 
0x8EC0B349149054A6,0xFEB68765452E6B6A,0x997E5330C0C214A4,0x3A15A96F06078DA8, 
0x114440E55C5C16E3,0x657C50D8C556322A,0x8D824EF35CC9B18D,0x62FAFDB9455B9877, 
0xBE7240C977BCF4C,0x428F91F09E626C35,0xB3AD14DCFEA6FE33,0x71D3C4CA016B49C9, 
0x7A6507B9299BDEAC,0x7B173AD40A91FC44,0x62BB05E87C5FD442,0x246BFD096A84F103, 
0x52426D6B9D8D47A0,0xE4BB917FB1C2191A,0xDC302C94A13C92CB,0xCEC02FCE33EB1809, 
0x144A90E21B0FD055,0xB130558FD3E7EC12,0x50EDC3B6EC344C9C,0x78AF9F52007E33B3, 
0x3FAA15C53BCC5183,0x2628B54F4D59AC4C,0xCC359C24C3C7C82A,0xB662FBE71ABD79A2, 
0x296BECB123B6B471,0xF13E060D6052DE41,0x97D247DC121FFAB1,0xEA937D00ACCB3BE4, 
0xF2C874424CF7EB45,0xE8A67AD0845E9875,0xFAE9B4C2E5283A3E,0xDEFC7887D66FB83B, 
0xC55961942EF56D88,0x1AE6877A81698BC1,0x5E4CCB8CAE5707B5,0x9E3C703DAE834CE9, 
0x21BD61882F660152,0xEA67C38767B0EA6A,0x7F17A3A0C007B8B,0xE5EFD3AFA361609F, 
0x42A48A60C15039E5,0x1BEFB92014D5A27F,0xBAB513F5A85B6C97,0x48497BC3DAFDFD67, 
0xF6AEFD7454DA6CA3,0x8653F0E4E90C5C1C,0xC66FD5575688B975,0x1CDF192DD0C47003, 
0x73651F8CAF8A560F,0x44BB58AD2A71CEA7,0xAFC1E3C7015AB065,0xAB3EE8FF78E441A9, 
0xD6C7D1DA506E9FAB,0x82209BED877C18BC,0xBC031C142567844A,0xC5C44F43AE219313, 
0xE80DF29EF7AEB3A7,0x855E6B20D289958C,0xA220CE015E72C732,0x3DE8A8719186E78, 
0xE11BCFB54DA98548,0xAF1C327CAE6C1827,0xF65F9E16613B1391,0x2774565DBC69AC86, 
0x69697E5E51691FDE,0x608818EEF0DFFD96,0x55CA4061CC449193,0x29C1A1E8A35AC7CB, 
0x145F101B409B52B4,0xB4EA6C8481F57E5C,0xF09202C4AAD55D3B,0xE2644022177A7FA3, 
0x9CC07785AA9B9F38,0x24B17A53135A229D,0xE1FB1336D31DC070,0x50EB148BCC994A27, 
0x67CBECB045BB084,0x1B0BD0A9C615171A,0xCA4A91EFA19E077A,0x42833091585C4ED7, 
0x8FC8248CFECAF72,0xEFA12B7288486DF7,0xF365FBFE0EA83E,0x6C1B1B5AAEB30EC8, 
0x386FCBE212B6F633,0x1C65928B7A29950D,0x93724C20857408F8,0x733DA9C0AD2C19D4, 
0xF5F4C19CDF63C776,0x9474B3E83AE8DA02,0x7C0416C6FCC8F539,0xA88F54B7B22668CE, 
0x92723D98C0E86A7A,0xF594A7E3EA441D17,0x5F7F84030289FF60,0x72F9FE14C36C5315, 
0xD374A0AB55064EC1,0x822E5D285D11603C,0xE604BBE0F25F32CE,0x20D8C78F74BD9BAB, 
0x7E07F1D70E7FDD4D,0x5E85DA008ABDD2DA,0xDA2C31523BFA23C4,0x6AA4E64DA533D8F4, 
0x3F3B77AB6ACAE50A,0x71400272D9A719BA,0x8AC44AFF353CDBE6,0xE9ADFEB168F160DE, 
0xDB47CE8BC7ED6316,0xEB4F4E96A9EA264C,0xE00D4B721E7214C5,0xDC76C130E053F1A0, 
0xB7D491D182E1AA8E,0xB45BFE9C337633FF,0xBEA6012EBD1DA3B2,0x5FAA8D00E3A6AAE4, 
0xD2658839BF7F1B99,0xE44E63752C7AE340,0x416A67E82F55E73B,0x3B636BC92F968203};
const fp p_minus_2 = {
0xFFFFFFFFFFFFFFFD,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0x3EAF65A95F0041EC,0x372B7D9154133882, 
0x5A58A580E1CA9829,0x8FC4156DDCAD437,0x4CE6AE3C63765131,0x4F3865F90F46D0D3, 
0xB6AA2C454C34E51B,0xD434D3F80A147B77,0x6B926F74A2AA5C76,0x43BCB530BDFEAFF9, 
0x671D6CE9572B43C1,0xD5B30D80ECB73020,0xF823265621739F49,0xC1754744306061CA, 
0x6171E42D89E177BB,0x8994F48EF23A7F2A,0xA2057C82B399C3AF,0xC60CD8BEC9D528B1, 
0xB9B5FAB739469676,0x601A2E4779AEC853,0xE00D857E16B58377,0xE65DEF66D0C08A1D, 
0x26692BC11E11E82B,0x3A2B8F6CD365560D,0x39E653855729C7FB,0xC10B3B5E0D9DE1C4, 
0x7D13530314EEC59E,0xD0A1B556BFEAF779,0xE63C16F48D4938B9,0x3839DF74876C52B0, 
0x5AD0EACB1BD7283,0xC1709D8F85717F0F,0x185BC2F57DE71EB1,0x2F9EC8170F78D4E0, 
0xF519D562D85DB142,0x9CCB77F2238053C5,0x6BB5CF773506E8B0,0x2770E39BEED00FEB, 
0x3A51E0099D663BC,0x5E93F3908FA8986E,0x4AE63438608085B,0x5290F3FDF0F9F666, 
0xA5E5B7F7D86B7F44,0xAB4BD70919AC3458,0x60473AD832847641,0xC35589BD7E5B6D68, 
0x60340C810D6E6475,0xDA4E9331BBBE84E,0x8726969D65FA39A0,0x558064826AE53F6C};
const fp inv_min_p_mod_r = {
0x1,0x0,0x0,0x0,
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x3EAF65A95F0041ED,0x372B7D9154133882,
0x5A58A580E1CA9829,0x8FC4156DDCAD437,0x4CE6AE3C63765131,0x4F3865F90F46D0D3, 
0xB6AA2C454C34E51B,0xD434D3F80A147B77,0x6B926F74A2AA5C76,0x43BCB530BDFEAFF9, 
0x671D6CE9572B43C1,0xD5B30D80ECB73020,0xF823265621739F49,0xC1754744306061CA, 
0x6171E42D89E177BB,0x8994F48EF23A7F2A,0xA2057C82B399C3AF,0xC60CD8BEC9D528B1, 
0xB9B5FAB739469676,0x601A2E4779AEC853,0xE00D857E16B58377,0xE65DEF66D0C08A1D, 
0x26692BC11E11E82B,0x3A2B8F6CD365560D,0x39E653855729C7FB,0xC10B3B5E0D9DE1C4, 
0x7D13530314EEC59E,0xD0A1B556BFEAF779,0xE63C16F48D4938B9,0x3839DF74876C52B0, 
0x5AD0EACB1BD7283,0xC1709D8F85717F0F,0x185BC2F57DE71EB1,0x2F9EC8170F78D4E0, 
0xF519D562D85DB142,0x9CCB77F2238053C5,0x6BB5CF773506E8B0,0x2770E39BEED00FEB, 
0x3A51E0099D663BC,0x5E93F3908FA8986E,0x4AE63438608085B,0x5290F3FDF0F9F666, 
0xA5E5B7F7D86B7F44,0xAB4BD70919AC3458,0x60473AD832847641,0xC35589BD7E5B6D68, 
0x60340C810D6E6475,0xDA4E9331BBBE84E,0x8726969D65FA39A0,0x558064826AE53F6C};

#ifdef MONTGOMERY
const fp fp_1 = {
0x2,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x82A134AD41FF7C26,0x91A904DD57D98EFB,
0x4B4EB4FE3C6ACFAD,0xEE077D52446A5791,0x6632A38739135D9D,0x618F340DE1725E59,
0x92ABA775679635C9,0x5796580FEBD70910,0x28DB2116BAAB4712,0x7886959E8402A00D, 
0x31C5262D51A9787D,0x5499E4FE26919FBF,0xFB9B353BD18C16C,0x7D1571779F3F3C6A, 
0x3D1C37A4EC3D1088,0xECD616E21B8B01AB,0xBBF506FA98CC78A0,0x73E64E826C55AE9C, 
0x8C940A918D72D312,0x3FCBA3710CA26F58,0x3FE4F503D294F911,0x334421325E7EEBC4, 
0xB32DA87DC3DC2FA8,0x8BA8E126593553E5,0x8C3358F551AC7009,0x7DE98943E4C43C77, 
0x5D959F9D62274C2,0x5EBC9552802A110D,0x3387D216E56D8E8C,0x8F8C4116F1275A9E, 
0xF4A5E2A69C851AF9,0x7D1EC4E0F51D01E1,0xCF487A150431C29C,0xA0C26FD1E10E563F, 
0x15CC553A4F449D7B,0xC669101BB8FF5874,0x2894611195F22E9E,0xB11E38C8225FE029, 
0xF8B5C3FECC533887,0x42D818DEE0AECF23,0xF6A33978F3EFEF49,0x5ADE18041E0C1333, 
0xB43490104F290177,0xA96851EDCCA7974E,0x3F718A4F9AF7137C,0x7954EC850349252F, 
0x3F97E6FDE5233714,0xE4B62D99C8882F63,0xF1B2D2C5340B8CBF,0x54FF36FB2A358126};
#else
const fp fp_1 = {0x1};
#endif

#define pbits 8191
#define itch_size 516

#elif defined P9215m85l389
const fp p = {
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xD4EB2E32201FF538,0x9731F6B12064E278,0x68F5236C9A6E8EEB, 
0x6FF70217C7682DD9,0xD996C5CAFCAB6BA6,0xEE5EF78FD74361DB,0x3BA7F52C9AA6F698, 
0xC9BEDE007C259BF0,0xD9A864CC7D33B52C,0x440F7936394BF5B6,0xCF4B1FD62F49C859, 
0x92D044003F20EADC,0xCD842B3809D80C8E,0x2FBDB1D89B9D569F,0x613F115278C53010, 
0xB95DE73343F27240,0xC92888276CA27909,0x28839A94D3CA2D5F,0x93147941B2E308, 
0x745BCF59034C79D5,0x73C37E1E3AE8FC67,0x2E9DE986D4FC8646,0x33859631C10023B1, 
0x15A2A2E2188C4BEC,0xBF8F6740D0BAE643,0x42FEB9CCCF7D3200,0x792C49D34520B80E, 
0x83959EC2A5E959BB,0xF6BB457B67E4747,0xCC1CA65F453F0CE5,0xCD0FC61342EC7176, 
0x45FA3489D307DC18,0xDA7FA26690C6E0F6,0x144DB37F4D0B736D,0x2F53EAEDABBEB338, 
0xA7015C360AFA08C0,0x282F93BFA396C390,0x701BE8C44F787FAD,0x5530DBBAB892409E, 
0x36E5E81E4162EAEE,0xBB332AD4236A07AD,0x3276B28E0577E3F1,0xA973F305069CC11E, 
0xDDD71DAAC305A437,0x21B47A8072B86EAE,0x799455FDCD01F2FF,0xFF4E3D96380C1004, 
0x3AF56DDA678BFF86,0xA882C926E07337F9,0xEB2143236B97EBF1,0x3A70A1E85E02F35A, 
0x49BDF004F95AC7F6,0x380D448104A8EB09,0x704E29C40AB77B69,0x199F2E3A6D2E23AC, 
0xA5252A0EFC013C8C,0x38CABDE8DD5935A4,0x57DEA1BECC1C7D9A,0x71A72AD537EA0C9E};

const fp r_squared_mod_p = {
0xA9AF7454F03D753C,0xFEE65A88EB10B5EA,0x4980B568F42EF7C1,0xB9D6862C549712E1, 
0xF4239DA640C945A8,0x84EE9556F038099A,0x9CCA409764812D51,0xB8EDDA69575EE654, 
0x150EBAF6B58EABD7,0x392BB3D9715CA58,0x202D9EEF0B9F5FC2,0x38847E9AAD3A47B5, 
0x51284A9012387F18,0xCDDEC9C363F777FE,0x1FBB90D81871E7A7,0x1688191F2B2EC4F8, 
0xFFEB61B2BEA7F4A3,0x73E922B23B71CDEC,0xDE544F4141AAE2FC,0xF90F8873A82100DA, 
0x613C7FF306B3AF8D,0x29D174286C1B2CDA,0x35E90A4395B92C78,0x2B2D6281513FC944, 
0xADF9F91549E9746C,0x3E0465589E71470,0x8B7B897823DC3A6A,0x74A3C4C0D12846FB, 
0xAD92B4AB385A3DB3,0xA3930061C92CFA0E,0x5F781937AE64D117,0x82C6215777B68905, 
0xDEF3C3145BC7B2F1,0x87F24F8F4F1E112F,0x314DFF2126BA61E5,0x31C281579EAE9897, 
0x9648810196467FCE,0xFE980E1121BD36DE,0xB2B9C6C30845A92C,0xE5F4ACE5ED6AF632, 
0xEE18832C0DA0CC25,0xE374111EAB629CE8,0xBEAD1E410C62E6B7,0x1823EA9CBA06F7F, 
0xE1288FED154D1D22,0xD107995A95B70C16,0x8DF03BB2F388753,0x68C6923955CC523F, 
0xF307589064657325,0x7588193C98BDF823,0x875B9F315976F842,0x5060CA00E83DE80F, 
0xAD35983FC3A5F915,0xAC3DD0C5A65E37E9,0xE2BAF636BB430A5A,0x4212254854B97C6, 
0x42A6CE9DFCDCC4B3,0x5F2E08142AA3DB17,0x86101CD89367F9ED,0x1305FE03894E87E2, 
0xB575E9183EF5F2C2,0xB4686F6F1310DFF5,0xC56385D2AD3A78D4,0xD90EE4E134A285E4, 
0x9C2292CD4327FBD6,0x3E7B5C5DBFECAD70,0x3CB62CB331D2741,0x684680AA15395048, 
0xEA7F5161C25758D4,0xBF0D628A9C4CED0B,0xCED6DFD589316357,0xB7F4226B82DF594C, 
0xFD04CFFAFA47D58E,0x5D12E0ACB3D5DB0A,0x5FA0DFEEA4BE8A68,0xDAC197A19D8022F2, 
0x792FCEFB77B0CD73,0x6EF6298AFF9E0071,0x57930BFE77528F10,0xD37C35612EAC87CA, 
0x4C2BFA87F55BB970,0xEE692F062C30EFFA,0x7B15F501C0FF5340,0x7DDC1A91500115A, 
0x66220BB592C92FC9,0xE9BB736255581E82,0x5ECD046373EE709E,0x8CC9480B502C54A2, 
0x1F4F6DE652111980,0xE584B1CE9FE0B22D,0x2CF974040027E2C1,0x41DD0CB68A42D0A2, 
0x9DB76995C1619789,0xB45231FDADA9B1F,0x999061E20793A24,0xA75426534E82053C, 
0x73BD53096A4F0736,0x67AC91E7E98175C5,0xFEF33A48823FE320,0x58A6437B0DC9EE51, 
0xF198D26093E681F4,0x8D561A87BF7A27F5,0xBDBB97CE527941D0,0x9BA8A2D827F45100, 
0x5B51CD62CC9FB4E8,0xDD3487FDBE61CA7C,0x7C45926ABF89F157,0x4D59C72ED024DF9D, 
0x608E0004D1F23117,0xCE15EF66F36DC092,0x22C35E250F3B49CE,0x396E1BCB93EC9421, 
0x447E34615B83E547,0x9854FB6A4F71FDA7,0xA8E9C4A2C61E8144,0x2578212CC18F2F50, 
0x3B47BF383A202BEC,0xDCB1B43AFE8635D4,0x8FADD43B539E2970,0xA3EFAFAB7CEA261F, 
0xAAAD864D0F60BE2D,0xCD56237772DB347B,0xEEEB874A946746A7,0x2DC373A87E502A2C, 
0xF7F73FEF213B1459,0xB377C5AF338F5BC0,0x7EC5C0C013C8AE60,0xFC85631CD8E9C939, 
0x7BBDA6593FEC2B29,0x43B0CD93CC2FE31E,0xE66717D87EEEAB5E,0xD85DA70EB28567A3, 
0xDB1999D954EEDE09,0xA98EE87A72267CB4,0xDFCCB4FAA2C1C0F3,0x36DFEA217B6EEC6E, 
0x14C0C6824F2108CD,0xF8184FC9A5EF1F26,0x10417975DEC645D8,0xFF1B45F96B8243F5, 
0x60904FE88DADDE7E,0xAD3FF045EBA9C25A,0x41C148DF8BD37786,0x292D4073D89AAF2B};

const fp p_minus_2 = {
0xFFFFFFFFFFFFFFFD,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF,0xFFFFFFFFFFFFFFFF, 
0xFFFFFFFFFFFFFFFF,0xD4EB2E32201FF538,0x9731F6B12064E278,0x68F5236C9A6E8EEB, 
0x6FF70217C7682DD9,0xD996C5CAFCAB6BA6,0xEE5EF78FD74361DB,0x3BA7F52C9AA6F698, 
0xC9BEDE007C259BF0,0xD9A864CC7D33B52C,0x440F7936394BF5B6,0xCF4B1FD62F49C859, 
0x92D044003F20EADC,0xCD842B3809D80C8E,0x2FBDB1D89B9D569F,0x613F115278C53010, 
0xB95DE73343F27240,0xC92888276CA27909,0x28839A94D3CA2D5F,0x93147941B2E308, 
0x745BCF59034C79D5,0x73C37E1E3AE8FC67,0x2E9DE986D4FC8646,0x33859631C10023B1, 
0x15A2A2E2188C4BEC,0xBF8F6740D0BAE643,0x42FEB9CCCF7D3200,0x792C49D34520B80E, 
0x83959EC2A5E959BB,0xF6BB457B67E4747,0xCC1CA65F453F0CE5,0xCD0FC61342EC7176, 
0x45FA3489D307DC18,0xDA7FA26690C6E0F6,0x144DB37F4D0B736D,0x2F53EAEDABBEB338, 
0xA7015C360AFA08C0,0x282F93BFA396C390,0x701BE8C44F787FAD,0x5530DBBAB892409E, 
0x36E5E81E4162EAEE,0xBB332AD4236A07AD,0x3276B28E0577E3F1,0xA973F305069CC11E, 
0xDDD71DAAC305A437,0x21B47A8072B86EAE,0x799455FDCD01F2FF,0xFF4E3D96380C1004, 
0x3AF56DDA678BFF86,0xA882C926E07337F9,0xEB2143236B97EBF1,0x3A70A1E85E02F35A, 
0x49BDF004F95AC7F6,0x380D448104A8EB09,0x704E29C40AB77B69,0x199F2E3A6D2E23AC, 
0xA5252A0EFC013C8C,0x38CABDE8DD5935A4,0x57DEA1BECC1C7D9A,0x71A72AD537EA0C9E};

const fp inv_min_p_mod_r = {
0x1,0x0,0x0,0x0,
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0xD4EB2E32201FF539,0x9731F6B12064E278,0x68F5236C9A6E8EEB,
0x6FF70217C7682DD9,0xD996C5CAFCAB6BA6,0xEE5EF78FD74361DB,0x3BA7F52C9AA6F698,
0xC9BEDE007C259BF0,0xD9A864CC7D33B52C,0x440F7936394BF5B6,0xCF4B1FD62F49C859, 
0x92D044003F20EADC,0xCD842B3809D80C8E,0x2FBDB1D89B9D569F,0x613F115278C53010, 
0xB95DE73343F27240,0xC92888276CA27909,0x28839A94D3CA2D5F,0x93147941B2E308, 
0x745BCF59034C79D5,0x73C37E1E3AE8FC67,0x2E9DE986D4FC8646,0x33859631C10023B1, 
0x15A2A2E2188C4BEC,0xBF8F6740D0BAE643,0x42FEB9CCCF7D3200,0x792C49D34520B80E,
0x83959EC2A5E959BB,0xF6BB457B67E4747,0xCC1CA65F453F0CE5,0xCD0FC61342EC7176, 
0x45FA3489D307DC18,0xDA7FA26690C6E0F6,0x144DB37F4D0B736D,0x2F53EAEDABBEB338, 
0xA7015C360AFA08C0,0x282F93BFA396C390,0x701BE8C44F787FAD,0x5530DBBAB892409E, 
0x36E5E81E4162EAEE,0xBB332AD4236A07AD,0x3276B28E0577E3F1,0xA973F305069CC11E, 
0xDDD71DAAC305A437,0x21B47A8072B86EAE,0x799455FDCD01F2FF,0xFF4E3D96380C1004, 
0x3AF56DDA678BFF86,0xA882C926E07337F9,0xEB2143236B97EBF1,0x3A70A1E85E02F35A, 
0x49BDF004F95AC7F6,0x380D448104A8EB09,0x704E29C40AB77B69,0x199F2E3A6D2E23AC, 
0xA5252A0EFC013C8C,0x38CABDE8DD5935A4,0x57DEA1BECC1C7D9A,0x71A72AD537EA0C9E};

#ifdef MONTGOMERY
const fp fp_1 = {
0x2,0x0,0x0,0x0,
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x0,0x0,0x0, 
0x0,0x5629A39BBFC0158E,0xD19C129DBF363B0E,0x2E15B926CB22E228,
0x2011FBD0712FA44D,0x4CD2746A06A928B3,0x234210E051793C48,0x88B015A6CAB212CE,
0x6C8243FF07B4C81F,0x4CAF3667059895A6,0x77E10D938D681492,0x6169C053A16C6F4D, 
0xDA5F77FF81BE2A46,0x64F7A98FEC4FE6E2,0xA0849C4EC8C552C0,0x3D81DD5B0E759FDF, 
0x8D443199781B1B7F,0x6DAEEFB126BB0DEC,0xAEF8CAD6586BA540,0xFED9D70D7C9A39EF, 
0x1748614DF9670C55,0x187903C38A2E0731,0xA2C42CF25606F373,0x98F4D39C7DFFB89D, 
0xD4BABA3BCEE76827,0x80E1317E5E8A3379,0x7A028C6661059BFE,0xDA76C5975BE8FE3, 
0xF8D4C27AB42D4C89,0xE128975093037170,0x67C6B3417581E635,0x65E073D97A271D12, 
0x740B96EC59F047CE,0x4B00BB32DE723E13,0xD764990165E91924,0xA1582A24A882998F, 
0xB1FD4793EA0BEE7F,0xAFA0D880B8D278DE,0x1FC82E77610F00A5,0x559E488A8EDB7EC3, 
0x92342FC37D3A2A23,0x8999AA57B92BF0A5,0x9B129AE3F510381C,0xAD1819F5F2C67DC3, 
0x4451C4AA79F4B790,0xBC970AFF1A8F22A2,0xCD7540465FC1A01,0x16384D38FE7DFF7, 
0x8A15244B30E800F2,0xAEFA6DB23F19900D,0x29BD79B928D0281C,0x8B1EBC2F43FA194A, 
0x6C841FF60D4A7013,0x8FE576FDF6AE29ED,0x1F63AC77EA91092D,0xCCC1A38B25A3B8A7, 
0xB5B5ABE207FD86E7,0x8E6A842E454D94B6,0x5042BC8267C704CB,0x1CB1AA55902BE6C3};
#else
const fp fp_1 = {0x1};
#endif
#define pbits 9215
#define itch_size 578

#endif

const fp fp_0 = {0x0};

void fp_enc(fp a, fp const b)
{
#ifdef MONTGOMERY
    fp_mul(a, b, r_squared_mod_p);
    CNT_FP_MUL_DEC();
#else
    //(void) a;
    //(void) b;
    fp_copy(a, b);
#endif
}
void fp_dec(fp a, fp const b)
{
#ifdef MONTGOMERY
    fp_mul(a, b, uintbig_1);
    CNT_FP_MUL_DEC();
#else
    //(void) a;
    //(void) b;
    fp_copy(a, b);
#endif
}

void fp_pow(fp b, const fp e, const fp a)
{
    // It is required that e > 0.
    if (fp_iszero(e))
    {
        fp_set1(b);
    }
    else
    {
        fp tmp;
        fp_copy(tmp, a);
        fp_dec(tmp, tmp);
        mp_size_t pow_size = mpn_sec_powm_itch(NUMBER_OF_WORDS, NUMBER_OF_WORDS, NUMBER_OF_WORDS);
        uint64_t tp_pow[pow_size];
        mpn_sec_powm(b, tmp, NUMBER_OF_WORDS, e, NUMBER_OF_WORDS, p, NUMBER_OF_WORDS, tp_pow);
        fp_enc(b, b);
    }
}

// static void reduce_once(fp x)
// {
//     fp tmp;
//     if (!mpn_sub_n(tmp, x, p, NUMBER_OF_WORDS))
//     {
//         fp_copy(x, tmp);
//     }
// }

void fp_cswap(fp x, fp y, uint8_t c)
{

    // uint64_t tmp, c64;

    // c64 = (uint64_t)-c;
    // for (int i = 0; i < NUMBER_OF_WORDS; i++)
    // {
    //     tmp = (y[i] ^ x[i]) & c64;
    //     x[i] ^= tmp;
    //     y[i] ^= tmp;
    // }

    mpn_cnd_swap(c, x, y, NUMBER_OF_WORDS);
}

void fp_copy(fp b, const fp a)
{
    for (uint8_t i = 0; i < NUMBER_OF_WORDS; i++)
    {
        b[i] = a[i];
    }
}

void fp_add(fp c, const fp a, const fp b)
{
    // (void)mpn_add_n(c, a, b, NUMBER_OF_WORDS);
    // CNT_FP_ADD_INC();
    // reduce_once(c);
    (void)mpn_add_n(c, a, b, NUMBER_OF_WORDS);
    mpn_cnd_sub_n(mpn_cmp(c, p, NUMBER_OF_WORDS) > 0, c, c, p, NUMBER_OF_WORDS);
    CNT_FP_ADD_INC();
}

void fp_sub(fp c, const fp a, const fp b)
{
    // mp_limb_t borrow = mpn_sub_n(c, a, b, NUMBER_OF_WORDS);
    // CNT_FP_ADD_INC();
    // if (borrow)
    // {
    //     mpn_add_n(c, c, p, NUMBER_OF_WORDS);
    // }

    mpn_cnd_add_n(mpn_sub_n(c, a, b, NUMBER_OF_WORDS), c, c, p, NUMBER_OF_WORDS);
    CNT_FP_ADD_INC();
}

/*
    see Algorithm 14.36 "Montgomery multiplication"
    https://cacr.uwaterloo.ca/hac/about/chap14.pdf
*/
void fp_mul(fp c, const fp a, const fp b)
{
#ifdef MONTGOMERY
    static __thread uint64_t tp[itch_size];

    // mp_size_t size = mpn_sec_mul_itch(NUMBER_OF_WORDS, 1) ;
    uint64_t A[NUMBER_OF_WORDS + 1] = {0x0};
    uint64_t tmp_1[NUMBER_OF_WORDS + 1] = {0x0};
    uint64_t tmp_2[NUMBER_OF_WORDS + 2] = {0x0};
    uint64_t a_i[1] = {0x0};
    for (int i = 0; i < NUMBER_OF_WORDS; i++)
    {
        // tmp_1 = x_i * y
        a_i[0] = a[i];
        mpn_sec_mul(tmp_1, b, NUMBER_OF_WORDS, a_i, 1, tp);

        // tmp_2 = A + x_i * y
        mpn_add(tmp_2, A, NUMBER_OF_WORDS + 1, tmp_1, NUMBER_OF_WORDS + 1);

        // tmp_1 = u_i * m
        mpn_sec_mul(tmp_1, p, NUMBER_OF_WORDS, tmp_2, 1, tp);

        // tmp_1 = A + x_i * y + u_i * m
        mpn_add(tmp_1, tmp_1, NUMBER_OF_WORDS + 1, tmp_2, NUMBER_OF_WORDS + 2);

        // A = (A + x_i * y + u_i * m) / r
        mpn_copyd(A, tmp_1 + 1, NUMBER_OF_WORDS);

        A[NUMBER_OF_WORDS] = 0;
    }

    mpn_cnd_sub_n(mpn_cmp(A, p, NUMBER_OF_WORDS) > 0, c, A, p, NUMBER_OF_WORDS);

#else
#ifndef USE_GMP_SEC_FUNCTIONS
    uint64_t tmp[NUMBER_OF_WORDS * 2];
    uint64_t thrash[NUMBER_OF_WORDS + 1];
    mpn_mul_n(tmp, a, b, NUMBER_OF_WORDS);
    mpn_tdiv_qr(thrash, c, 0, tmp, 2 * NUMBER_OF_WORDS, p, NUMBER_OF_WORDS);
#else
    static __thread uint64_t tp[itch_size];
    uint64_t tmp[NUMBER_OF_WORDS * 2];
    mpn_sec_mul(tmp, a, NUMBER_OF_WORDS, b, NUMBER_OF_WORDS, tp);
    mpn_sec_div_r(tmp, 2 * NUMBER_OF_WORDS, p, NUMBER_OF_WORDS, tp);
    fp_copy(c, tmp);
#endif
#endif

    CNT_FP_MUL_INC();
}

void fp_sqr(fp b, const fp a)
{
#ifdef MONTGOMERY
    // fp_mul(b, a, a);
    // CNT_FP_MUL_DEC();

    uint64_t tmp[NUMBER_OF_WORDS * 2];
    mpn_sqr(tmp, a, NUMBER_OF_WORDS);
    fp_mont_redc(b, tmp);

#else
#ifndef USE_GMP_SEC_FUNCTIONS
    uint64_t tmp[NUMBER_OF_WORDS * 2];
    uint64_t thrash[NUMBER_OF_WORDS + 1];
    mpn_sqr(tmp, a, NUMBER_OF_WORDS);
    mpn_tdiv_qr(thrash, b, 0, tmp, 2 * NUMBER_OF_WORDS, p, NUMBER_OF_WORDS);
#else
    fp_mul(b, a, a);
    CNT_FP_MUL_DEC();
//     mpn_sec_sqr(tmp, a, NUMBER_OF_WORDS, tp);
//     mpn_sec_div_r(tmp, 2 * NUMBER_OF_WORDS, p, NUMBER_OF_WORDS, tp);
#endif
#endif
    CNT_FP_SQR_INC();
}

bool fp_issquare(fp const a)
{
    mpz_t mpzx, mpzp;
    int s = mpz_legendre(mpz_roinit_n(mpzx, a, NUMBER_OF_WORDS), mpz_roinit_n(mpzp, p, NUMBER_OF_WORDS));
    return s + 1;
}

void fp_inv(fp x)
{
#if defined(USE_GMP_SEC_FUNCTIONS) || defined(MONTGOMERY)
    static __thread uint64_t tp[itch_size];
#endif
#ifdef MONTGOMERY
    fp_dec(x, x);
    fp tmp;
    fp_copy(tmp, x);
    mpn_sec_invert(x, tmp, p, NUMBER_OF_WORDS, (unsigned int)(2 * NUMBER_OF_WORDS * mp_bits_per_limb), tp);
    fp_enc(x, x);
#else
#ifndef USE_GMP_SEC_FUNCTIONS
    mpz_t res, mpzx, mpzp;
    mpz_init(res);
    mpz_roinit_n(mpzx, x, NUMBER_OF_WORDS);
    mpz_roinit_n(mpzp, p, NUMBER_OF_WORDS);
    mpz_invert(res, mpzx, mpzp);
    int i = 0;
    for (; i < res->_mp_size; ++i)
    {
        x[i] = ((uint64_t *)res->_mp_d)[i];
    }
    for (; i < NUMBER_OF_WORDS; ++i)
    {
        x[i] = 0;
    }
    mpz_clear(res);
#else
    fp tmp;
    fp_copy(tmp, x);
    mpn_sec_invert(x, tmp, p, NUMBER_OF_WORDS, (unsigned int)(2 * NUMBER_OF_WORDS * mp_bits_per_limb), tp);
#endif
#endif
}

#ifdef MONTGOMERY
/*
    see Algorithm 14.32 "Montgomery reduction"
    https://cacr.uwaterloo.ca/hac/about/chap14.pdf
*/
void fp_mont_redc(fp a, const uint64_t b[2 * NUMBER_OF_WORDS])
{
    static __thread uint64_t tp[itch_size];
    uint64_t A[2 * NUMBER_OF_WORDS + 1] = {0x0};
    // uint64_t a_i[1] = {0x0};
    uint64_t tmp_1[NUMBER_OF_WORDS + 1] = {0x0};

    // 1. A = T
    mpn_copyd(A, b, 2 * NUMBER_OF_WORDS);

    for (int i = 0; i < NUMBER_OF_WORDS; i++)
    {
        // 2.1 u_i = a_i * m' mod b
        // since montgomery friendly m' = 1
        // a_i[0] = A[i];

        // 2.2 tmp_1 = u_i * m
        mpn_sec_mul(tmp_1, p, NUMBER_OF_WORDS, &A[i], 1, tp);

        // 2.2 A = A + u_i * m * b^i
        mpn_add(A + i, A + i, 2 * NUMBER_OF_WORDS + 1, tmp_1, NUMBER_OF_WORDS + 1);
    }

    // 3. A = A/b^n
    mpn_copyd(a, A + NUMBER_OF_WORDS, NUMBER_OF_WORDS);

    // 4. If A > m then A = A - m
    mpn_cnd_sub_n(mpn_cmp(a, p, NUMBER_OF_WORDS) > 0, a, a, p, NUMBER_OF_WORDS);
}
#endif

void fp_random(fp x)
{
    while (1)
    {
        randombytes(x, sizeof(fp));
        uint64_t m = ((uint64_t)1 << pbits % 64) - 1;
        x[NUMBER_OF_WORDS - 1] &= m;

        for (size_t i = NUMBER_OF_WORDS - 1; i < NUMBER_OF_WORDS; --i)
            if (x[i] < p[i])
                return;
            else if (x[i] > p[i])
                break;
    }
}
